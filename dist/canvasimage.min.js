/**
 * CanvasImage.js - v0.3.0 - build 2013-10-15 23:10:30
 * Author: Denis Radin aka PixelsCommander
 * Copyright (c) 2013 ; Licensed MIT
 */
function insertAfter(a,b){a.parentNode.insertBefore(b,a.nextSibling)}window.CanvasImage=function(){var a=function(a){this.container="string"==typeof a?document.querySelector(a):a,this.sourceURL=this.container.getAttribute("src"),this.loadImage(this.sourceURL,this.initializeCanvas)},b=a.prototype;return b.loadImage=function(a,b){this.imageObject=this.container,"img"!==this.container.tagName.toLowerCase()&&(this.imageObject=document.createElement("img")),this.imageObject.complete?b.bind(this)():(this.imageObject.onload=b.bind(this),"img"!==this.container.tagName.toLowerCase()&&(this.imageObject.src=a))},b.initializeCanvas=function(){this.imageObject.onload=null,this.canvas=document.createElement("canvas"),this.containerParent=this.container.parentNode,this.containerWidth=this.container.offsetWidth,this.containerHeight=this.container.offsetHeight,insertAfter(this.container,this.canvas),this.context=this.canvas.getContext("2d"),this.canvas.width=this.containerWidth,this.canvas.style.width=this.container.style.width,this.canvas.height=this.containerHeight,this.canvas.style.height=this.container.style.height,this.canvas.style.top=this.container.style.top,this.canvas.style.left=this.container.style.left,this.canvas.style.maxWidth=this.container.style.maxWidth,this.canvas.style.maxHeight=this.container.style.maxHeight,this.drawImage()},b.drawImage=function(){this.imageObject.width,this.imageObject.height;var a=this.getAffectedRectangle(this.imageObject);this.context.drawImage(this.imageObject,0,0,a.width,a.height),this.cleanMemory()},b.getAffectedRectangle=function(){var a={};return a.width=this.containerWidth,a.height=this.containerHeight,a},b.cleanMemory=function(){this.imageObject.src="",this.containerParent.removeChild(this.container),delete this.container,this.container!==this.imageObject&&delete this.imageObject,delete this.context,this.container=null,this.canvas=null,this.context=null,this.containerParent=null,this.imageObject=null,this.containerWidth=null,this.containerHeight=null,this.sourceURL=null},a.all=function(){for(var b=document.getElementsByTagName("img"),c=0;c<b.length;c++)new a(b[c]),c--},a}(window);